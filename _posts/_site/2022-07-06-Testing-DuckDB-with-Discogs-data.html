<p align="center">
  <img width="400" src="https://github.com/duckdb/duckdb/blob/master/logo/DuckDB_Logo.png?raw=true" alt="DuckDB_Logo" />
</p>

<p>This notebook is a small example of using DuckDB with the Python API.</p>

<ul>
  <li>What is <a href="https://github.com/duckdb/duckdb">DuckDB</a>?</li>
</ul>

<blockquote>
  <p>DuckDB is an in-process SQL OLAP Database Management System</p>
</blockquote>

<p>It is a relational DBMS that supports SQL. OLAP stands for <em>Online analytical processing</em>, generally associated with complex queries, scanning a lot of data in order to generate some reports, as opposed to processing transactions. DuckDB is speeding up the data analysis process when dealing with rather large datasets. A key factor of this efficiency is the columnar-vectorized query execution engine. <em>In-process</em> means that DuckDB does not follow the client-server model and runs entirely within the host process.</p>

<p>DuckDB is released under a MIT License. How can you install DuckDB with the Python API? Well it is as simple as:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>duckdb
</code></pre></div></div>

<p>Voilà!</p>

<p align="center">
  <img width="400" src="https://upload.wikimedia.org/wikipedia/en/thumb/e/e8/Discogs_logo.svg/2560px-Discogs_logo.svg.png" alt="Discogs_Logo" />
</p>

<ul>
  <li>What is <a href="https://www.discogs.com/">Discogs</a>? Here is a description from <a href="https://en.wikipedia.org/wiki/Discogs">wikipedia</a>:</li>
</ul>

<blockquote>
  <p>Discogs is a website and crowdsourced database of information about audio recordings, including commercial releases, promotional releases, and bootleg or off-label releases.</p>
</blockquote>

<p>Monthly dumps of Discogs data (Release, Artist, Label, and Master Release data) can be downloaded from their <a href="http://data.discogs.com/?prefix=data/2022/">website</a>, as compressed XML files. We used the nifty tool <a href="https://github.com/philipmat/discogs-xml2db">discogs-xml2db</a> to convert the XML files into CSV files, that we are going to load into DuckDB. We also used it to load the same data into PostgreSQL in order to later measure and compare the execution time of a query.</p>

<p>In the following notebook, we are going to create a database with the following selection of tables (over 25+ available tables):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SELECTED_TABLE_NAMES</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># Selection of tables to import into the DB
</span>    <span class="sh">"</span><span class="s">artist</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">artist_alias</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">artist_namevariation</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">release</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">release_genre</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">release_artist</span><span class="sh">"</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div></div>

<p>Let’s start with the Python imports.</p>

<h2 id="imports">Imports</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">urllib</span>
<span class="kn">from</span> <span class="n">time</span> <span class="kn">import</span> <span class="n">perf_counter</span>

<span class="kn">import</span> <span class="n">duckdb</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">pyarrow.parquet</span> <span class="k">as</span> <span class="n">pq</span>
<span class="kn">from</span> <span class="n">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
</code></pre></div></div>

<p>Package versions:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Python          : 3.9.13 
duckdb          : 0.4.0
pyarrow         : 8.0.0
JupyterLab      : 3.4.3
Pandas          : 1.4.3
</code></pre></div></div>

<p>We also import some Jupyter extensions, so that we can create some SQL cells later:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">load_ext</span> <span class="n">sql</span>
<span class="o">%</span><span class="n">config</span> <span class="n">SqlMagic</span><span class="p">.</span><span class="n">autopandas</span> <span class="o">=</span> <span class="bp">True</span>
<span class="o">%</span><span class="n">config</span> <span class="n">SqlMagic</span><span class="p">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="bp">False</span>
<span class="o">%</span><span class="n">config</span> <span class="n">SqlMagic</span><span class="p">.</span><span class="n">displaycon</span> <span class="o">=</span> <span class="bp">False</span>
</code></pre></div></div>

<h2 id="data-loading">Data Loading</h2>

<p>In order to batch import the data into DuckDB, we need some CSV or Parquet files. Here we have 6 CSV files, corresponding to the tables <code class="language-plaintext highlighter-rouge">SELECTED_TABLE_NAMES</code> from the Discogs database:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CSV_FILES</span> <span class="o">=</span> <span class="sh">"</span><span class="s">/home/francois/Data/Disk_1/discogs_data/*.csv</span><span class="sh">"</span>

<span class="c1"># list the CSV files located in the data directory
</span><span class="n">csv_file_paths</span> <span class="o">=</span> <span class="n">glob</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="n">CSV_FILES</span><span class="p">)</span>
<span class="n">csv_file_paths</span><span class="p">.</span><span class="nf">sort</span><span class="p">()</span>

<span class="c1"># look for the CSV files corresponding to the selected tables
</span><span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">csv_file_path</span> <span class="ow">in</span> <span class="n">csv_file_paths</span><span class="p">:</span>
    <span class="n">csv_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">)</span>
    <span class="n">table_name</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">splitext</span><span class="p">(</span><span class="n">csv_file_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">SELECTED_TABLE_NAMES</span><span class="p">:</span>
        <span class="n">tables</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">table_name</span><span class="p">,</span> <span class="n">csv_file_path</span><span class="p">))</span>
        <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getsize</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000000.0</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Table </span><span class="si">{</span><span class="n">table_name</span><span class="si">:</span><span class="mi">20</span><span class="n">s</span><span class="si">}</span><span class="s"> - CSV file size : </span><span class="si">{</span><span class="n">file_size</span><span class="si">:</span><span class="mf">8.2</span><span class="n">f</span><span class="si">}</span><span class="s"> MB</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Table artist               - CSV file size :   580.77 MB
Table artist_alias         - CSV file size :   105.62 MB
Table artist_namevariation - CSV file size :    93.16 MB
Table release              - CSV file size :  2540.58 MB
Table release_artist       - CSV file size :  3973.41 MB
Table release_genre        - CSV file size :   369.94 MB
</code></pre></div></div>

<p>First we need to connect to the DuckDB database, specifying a file path:</p>

<pre><code class="language-Python">conn = duckdb.connect(db_path)
</code></pre>

<p>If the database file does not already exists, it is created. The data is then loaded from the CSV files into the database, for example using a <code class="language-plaintext highlighter-rouge">CREATE TABLE table_name AS SELECT * FROM 'csv_file_path'</code> command. The database is saved into disk as a DuckDB file. In the present case, data loading takes around 5 minutes the first time:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE artist AS SELECT * FROM '/home/francois/Data/Disk_1/discogs_data/artist.csv' - Elapsed time:   8.33 s
CREATE TABLE artist_alias AS SELECT * FROM '/home/francois/Data/Disk_1/discogs_data/artist_alias.csv' - Elapsed time:   8.35 s
CREATE TABLE artist_namevariation AS SELECT * FROM '/home/francois/Data/Disk_1/discogs_data/artist_namevariation.csv' - Elapsed time:   3.85 s
CREATE TABLE release AS SELECT * FROM '/home/francois/Data/Disk_1/discogs_data/release.csv' - Elapsed time:  38.06 s
CREATE TABLE release_artist AS SELECT * FROM '/home/francois/Data/Disk_1/discogs_data/release_artist.csv' - Elapsed time: 103.13 s
CREATE TABLE release_genre AS SELECT * FROM '/home/francois/Data/Disk_1/discogs_data/release_genre.csv' - Elapsed time: 138.63 s
CPU times: user 4min 47s, sys: 15.9 s, total: 5min 3s
Wall time: 5min
</code></pre></div></div>

<p>Two files are actually created by DuckDB:</p>
<ul>
  <li>DiscogsDB : 6.5GB</li>
  <li>DiscogsDB.wal : 319 MB
The <code class="language-plaintext highlighter-rouge">.wal</code> file a <a href="https://github.com/duckdb/duckdb/issues/301#issuecomment-1011335087">checkpoint file</a>. It is actually removed when closing the connection, and not created when connecting to the database in <code class="language-plaintext highlighter-rouge">read_only</code> mode.</li>
</ul>

<p>Subsequent connections only take a fraction of a second.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db_path</span> <span class="o">=</span> <span class="sh">"</span><span class="s">/home/francois/Data/Disk_1/discogs_data/DiscogsDB</span><span class="sh">"</span>
<span class="n">db_exists</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isfile</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
<span class="n">db_exists</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>True
</code></pre></div></div>

<p>In the present case, the database has already been created, so we just connect to it in read-only mode. From the <a href="https://duckdb.org/docs/api/python/overview#startup--shutdown">documentation</a>:</p>

<blockquote>
  <p>If the database file does not exist, it will be created (the file extension may be <code class="language-plaintext highlighter-rouge">.db</code>, <code class="language-plaintext highlighter-rouge">.duckdb</code>, or anything else). The special value <code class="language-plaintext highlighter-rouge">:memory:</code> (the default) can be used to create an in-memory database. Note that for an in-memory database no data is persisted to disk (i.e. all data is lost when you exit the Python process). If you would like to connect to an existing database in read-only mode, you can set the <code class="language-plaintext highlighter-rouge">read_only</code> flag to <code class="language-plaintext highlighter-rouge">True</code>. Read-only mode is required if multiple Python processes want to access the same database file at the same time.</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">time</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">db_exists</span><span class="p">:</span>

    <span class="n">conn</span> <span class="o">=</span> <span class="n">duckdb</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="c1"># load the CSV files and create the tables
</span>    <span class="k">for</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">csv_file_path</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"""</span><span class="s">CREATE TABLE </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s"> AS SELECT * FROM </span><span class="sh">'</span><span class="si">{</span><span class="n">csv_file_path</span><span class="si">}</span><span class="sh">'"""</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nf">perf_counter</span><span class="p">()</span>
        <span class="n">conn</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">elapsed_time_s</span> <span class="o">=</span> <span class="nf">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s"> - Elapsed time: </span><span class="si">{</span><span class="n">elapsed_time_s</span><span class="si">:</span><span class="mf">6.2</span><span class="n">f</span><span class="si">}</span><span class="s"> s</span><span class="sh">"</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>

    <span class="n">conn</span> <span class="o">=</span> <span class="n">duckdb</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 687 ms, sys: 187 ms, total: 873 ms
Wall time: 869 ms
</code></pre></div></div>

<h2 id="querying">Querying</h2>

<p>Let’s test if the connection is working, by executing a query with the <code class="language-plaintext highlighter-rouge">execute()</code> method:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">query</span> <span class="o">=</span> <span class="sh">"</span><span class="s">SELECT COUNT(*) FROM artist</span><span class="sh">"</span>
<span class="n">conn</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">conn</span><span class="p">.</span><span class="nf">fetchone</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(8107524,)
</code></pre></div></div>

<p>Seems to be OK!</p>

<h3 id="pandas">Pandas</h3>

<p>We can use the <code class="language-plaintext highlighter-rouge">.df()</code> method if we want the query execution to return a Pandas dataframe:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">query</span> <span class="o">=</span> <span class="sh">"</span><span class="s">SELECT * FROM artist LIMIT 5</span><span class="sh">"</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">).</span><span class="nf">df</span><span class="p">()</span>
<span class="n">df</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>realname</th>
      <th>profile</th>
      <th>data_quality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>The Persuader</td>
      <td>Jesper Dahlbäck</td>
      <td>NaN</td>
      <td>Needs Vote</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Mr. James Barth &amp; A.D.</td>
      <td>Cari Lekebusch &amp; Alexi Delano</td>
      <td>NaN</td>
      <td>Correct</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Josh Wink</td>
      <td>Joshua Winkelman</td>
      <td>After forming [l=Ovum Recordings] as an indepe...</td>
      <td>Needs Vote</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Johannes Heil</td>
      <td>Johannes Heil</td>
      <td>Electronic music producer, musician and live p...</td>
      <td>Needs Vote</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Heiko Laux</td>
      <td>Heiko Laux</td>
      <td>German DJ and producer based in Berlin. He is ...</td>
      <td>Needs Vote</td>
    </tr>
  </tbody>
</table>
</div>

<p>We could also create a table from a dataframe, if not in <code class="language-plaintext highlighter-rouge">read_only</code> mode, or query the dataframe in SQL:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">query</span> <span class="o">=</span> <span class="sh">"</span><span class="s">SELECT COUNT(*) FROM df</span><span class="sh">"</span>
<span class="n">conn</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">).</span><span class="nf">fetchone</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(5,)
</code></pre></div></div>

<h3 id="arrow">Arrow</h3>

<p>We can export the result of a query as a <a href="https://arrow.apache.org/docs/python/generated/pyarrow.Table.html">PyArrow table</a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">query</span> <span class="o">=</span> <span class="sh">"</span><span class="s">SELECT * FROM artist LIMIT 1000</span><span class="sh">"</span>
<span class="n">tabl</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">).</span><span class="nf">arrow</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">type</span><span class="p">(</span><span class="n">tabl</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pyarrow.lib.Table
</code></pre></div></div>

<p>And also query this arrow table:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">query</span> <span class="o">=</span> <span class="sh">"</span><span class="s">SELECT COUNT(*) FROM tabl</span><span class="sh">"</span>
<span class="n">conn</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">).</span><span class="nf">fetchone</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1000,)
</code></pre></div></div>

<h2 id="jupyterlab">JupyterLab</h2>

<p>We can also create some SQL cells directly using the DuckDB Python client. First we need to connect:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">sql</span> <span class="n">duckdb</span><span class="p">:</span><span class="o">///</span><span class="p">{</span><span class="n">db_path</span><span class="p">}</span>
</code></pre></div></div>

<p>Then we can create SQL cells starting with the <code class="language-plaintext highlighter-rouge">%sql</code> magic command:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">sql</span> <span class="n">SELECT</span> <span class="nc">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">artist</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count_star()</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8107524</td>
    </tr>
  </tbody>
</table>
</div>

<p>What if we want a SQL cell to return a Pandas dataframe? We can assign the result of query to a dataframe using the <code class="language-plaintext highlighter-rouge">&lt;&lt;</code> operator.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">sql</span> <span class="n">df</span> <span class="o">&lt;&lt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">release_artist</span> <span class="n">LIMIT</span> <span class="mi">3</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Returning data to local variable df
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>release_id</th>
      <th>artist_id</th>
      <th>artist_name</th>
      <th>...</th>
      <th>role</th>
      <th>tracks</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>The Persuader</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>507025</td>
      <td>George Cutmaster General</td>
      <td>...</td>
      <td>Lacquer Cut By</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>239</td>
      <td>Jesper Dahlbäck</td>
      <td>...</td>
      <td>Written-By [All Tracks By]</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">sql</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">df</span> <span class="n">WHERE</span> <span class="n">artist_name</span> <span class="o">=</span> <span class="sh">'</span><span class="s">The Persuader</span><span class="sh">'</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>release_id</th>
      <th>artist_id</th>
      <th>artist_name</th>
      <th>...</th>
      <th>role</th>
      <th>tracks</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>The Persuader</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="export">Export</h2>

<p>We can export the result of a SQL query into a CSV or a Parquet file.</p>

<h3 id="csv-export">CSV export</h3>

<p>A <code class="language-plaintext highlighter-rouge">COPY</code> statement can bu used to export the result of a query as a CSV file:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">csv_file_path</span> <span class="o">=</span> <span class="sh">"</span><span class="s">./artist.csv</span><span class="sh">"</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">sql</span> <span class="nc">COPY </span><span class="p">(</span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">artist</span> <span class="n">LIMIT</span> <span class="mi">1000</span><span class="p">)</span> <span class="n">TO</span> <span class="sh">'</span><span class="s">{csv_file}</span><span class="sh">'</span> <span class="nc">WITH </span><span class="p">(</span><span class="n">HEADER</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DELIMITER</span> <span class="sh">'</span><span class="s">,</span><span class="sh">'</span><span class="p">);</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="parquet-export">Parquet export</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">parquet_file_path</span> <span class="o">=</span> <span class="sh">"</span><span class="s">./artist.parquet</span><span class="sh">"</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">sql</span> <span class="nc">COPY </span><span class="p">(</span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">artist</span> <span class="n">LIMIT</span> <span class="mi">1000</span><span class="p">)</span> <span class="n">TO</span> <span class="sh">'</span><span class="s">{parquet_file_path}</span><span class="sh">'</span> <span class="p">(</span><span class="n">FORMAT</span> <span class="n">PARQUET</span><span class="p">);</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">table</span> <span class="o">=</span> <span class="n">pq</span><span class="p">.</span><span class="nf">read_table</span><span class="p">(</span><span class="n">parquet_file_path</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">table</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1000, 5)
</code></pre></div></div>

<p>The Parquet file can also be queried directly:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">sql</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="nf">read_parquet</span><span class="p">(</span><span class="sh">'</span><span class="s">{parquet_file_path}</span><span class="sh">'</span><span class="p">)</span> <span class="n">LIMIT</span> <span class="mi">5</span><span class="p">;</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>realname</th>
      <th>profile</th>
      <th>data_quality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>The Persuader</td>
      <td>Jesper Dahlbäck</td>
      <td>None</td>
      <td>Needs Vote</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Mr. James Barth &amp; A.D.</td>
      <td>Cari Lekebusch &amp; Alexi Delano</td>
      <td>None</td>
      <td>Correct</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Josh Wink</td>
      <td>Joshua Winkelman</td>
      <td>After forming [l=Ovum Recordings] as an indepe...</td>
      <td>Needs Vote</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Johannes Heil</td>
      <td>Johannes Heil</td>
      <td>Electronic music producer, musician and live p...</td>
      <td>Needs Vote</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Heiko Laux</td>
      <td>Heiko Laux</td>
      <td>German DJ and producer based in Berlin. He is ...</td>
      <td>Needs Vote</td>
    </tr>
  </tbody>
</table>
</div>

<p>As explained in the <a href="https://duckdb.org/docs/guides/import/query_parquet">documentation</a>:</p>

<blockquote>
  <p>The Parquet file will be processed in parallel. Filters will be automatically pushed down into the Parquet scan, and only the relevant columns will be read automatically.</p>
</blockquote>

<p>There are many many more useful features available with DuckDB and we refer to the <a href="https://duckdb.org/docs/">documentation</a> for  an overview of all what can be done with DuckDB. Now let’s focus on a simple test case.</p>

<h2 id="a-more-complex-query">A More complex query</h2>

<p>Now we are going to create a little more complex query. We want to compute the number of releases per year and per music genre. So we only need to use 2 distinct tables: <code class="language-plaintext highlighter-rouge">release</code> and <code class="language-plaintext highlighter-rouge">release_genre</code>. One of the issues is that the <code class="language-plaintext highlighter-rouge">year_released</code> column from the contains a string entered by the Discogs contributors, that may vary in its form, but usually looks like <code class="language-plaintext highlighter-rouge">yyyy-mm-dd</code>. In order to get the release year, we are going to take the first 4 characters from the <code class="language-plaintext highlighter-rouge">year_released</code> field and assume it’s a numeric year.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">query</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">SELECT se.year_released,
       se.genre,
       Count(*) AS release_count
FROM   (SELECT Substr(re.released, 1, 4) AS YEAR_RELEASED,
               re.id,
               re_g.genre
        FROM   release AS re
               LEFT JOIN release_genre AS re_g
                      ON re.id = re_g.release_id
        WHERE  re.released IS NOT NULL
               AND re.released NOT IN ( </span><span class="sh">'</span><span class="s">?</span><span class="sh">'</span><span class="s"> )) AS se
GROUP  BY se.year_released,
          se.genre
ORDER  BY release_count DESC</span><span class="sh">"""</span>
</code></pre></div></div>

<h3 id="duckdb">DuckDB</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">start</span> <span class="o">=</span> <span class="nf">perf_counter</span><span class="p">()</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">).</span><span class="nf">df</span><span class="p">()</span>
<span class="n">elapsed_time_s_1</span> <span class="o">=</span> <span class="nf">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Elapsed time: </span><span class="si">{</span><span class="n">elapsed_time_s_1</span><span class="si">:</span><span class="mf">6.2</span><span class="n">f</span><span class="si">}</span><span class="s"> s</span><span class="sh">"</span><span class="p">)</span>
<span class="n">df1</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Elapsed time:   1.81 s
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>YEAR_RELEASED</th>
      <th>genre</th>
      <th>release_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020</td>
      <td>Electronic</td>
      <td>162166</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018</td>
      <td>Electronic</td>
      <td>156421</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019</td>
      <td>Electronic</td>
      <td>152393</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2017</td>
      <td>Electronic</td>
      <td>151043</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2016</td>
      <td>Electronic</td>
      <td>148127</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df1</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1647, 3)
</code></pre></div></div>

<h3 id="postgresql">PostgreSQL</h3>

<p>PostgreSQL client and server are installed on the same computer as DuckDB.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PG_USERNAME</span> <span class="o">=</span> <span class="sh">"</span><span class="s">discogs_user</span><span class="sh">"</span>
<span class="n">PG_PASSWORD</span> <span class="o">=</span> <span class="sh">"</span><span class="s">****</span><span class="sh">"</span>
<span class="n">PG_SERVER</span> <span class="o">=</span> <span class="sh">"</span><span class="s">localhost</span><span class="sh">"</span>
<span class="n">PG_PORT</span> <span class="o">=</span> <span class="mi">5432</span>
<span class="n">PG_DATABASE</span> <span class="o">=</span> <span class="sh">"</span><span class="s">discogsdb</span><span class="sh">"</span>
<span class="n">CONNECT_STRING</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="sh">"</span><span class="s">postgresql+psycopg2://</span><span class="si">{</span><span class="n">PG_USERNAME</span><span class="si">}</span><span class="s">:</span><span class="sh">"</span>
    <span class="o">+</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="nf">quote_plus</span><span class="p">(</span><span class="n">PG_PASSWORD</span><span class="p">)</span><span class="si">}</span><span class="s">@</span><span class="si">{</span><span class="n">PG_SERVER</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">PG_PORT</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">PG_DATABASE</span><span class="si">}</span><span class="sh">"</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span> <span class="o">=</span> <span class="nf">create_engine</span><span class="p">(</span><span class="n">CONNECT_STRING</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">start</span> <span class="o">=</span> <span class="nf">perf_counter</span><span class="p">()</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
<span class="n">elapsed_time_s_2</span> <span class="o">=</span> <span class="nf">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Elapsed time: </span><span class="si">{</span><span class="n">elapsed_time_s_2</span><span class="si">:</span><span class="mf">6.2</span><span class="n">f</span><span class="si">}</span><span class="s"> s</span><span class="sh">"</span><span class="p">)</span>
<span class="n">df2</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Elapsed time:  21.51 s
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year_released</th>
      <th>genre</th>
      <th>release_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020</td>
      <td>Electronic</td>
      <td>162166</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018</td>
      <td>Electronic</td>
      <td>156421</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019</td>
      <td>Electronic</td>
      <td>152393</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2017</td>
      <td>Electronic</td>
      <td>151043</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2016</td>
      <td>Electronic</td>
      <td>148127</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1647, 3)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">DuckDB</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">elapsed_time_s_1</span><span class="p">],</span> <span class="sh">"</span><span class="s">PostGreSQL</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">elapsed_time_s_2</span><span class="p">]},</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">""</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">plot</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sh">"</span><span class="s">Query execution time</span><span class="sh">"</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="sh">"</span><span class="s">DB</span><span class="sh">"</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sh">"</span><span class="s">Elapsed time (s)</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p align="center">
  <img width="500" src="/img/2022-07-06_01/output_61_0.png" alt="Query execution time" />
</p>

<p>So the same query on the same computer is executed about 10 times faster with DuckDB than with PostgreSQL (both DB with default settings).</p>

<p>To conclude this post, let’s plot the result of the previous query with Pandas/Matplotlib.</p>

<h3 id="evolution-of-the-10-most-popular-genres-ever">Evolution of the 10 most popular genres ever</h3>

<p>The first job is to filter out ambiguous entries such as <code class="language-plaintext highlighter-rouge">197</code>, <code class="language-plaintext highlighter-rouge">197?</code>, <code class="language-plaintext highlighter-rouge">70's</code> and convert the <code class="language-plaintext highlighter-rouge">year</code> variable to <code class="language-plaintext highlighter-rouge">int</code> … Then we pivot the table in order to have each genre in a distinct column. We select years between 1940 and 2020 (data might be missing for the recent releases, in 2021 and 2022, because it has not been entered into the DB yet).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">df1</span><span class="p">.</span><span class="n">YEAR_RELEASED</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="nf">isnumeric</span><span class="p">()</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df1</span><span class="p">.</span><span class="n">YEAR_RELEASED</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="nf">len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)].</span><span class="nf">copy</span><span class="p">(</span>
    <span class="n">deep</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
<span class="n">df1</span><span class="p">.</span><span class="n">YEAR_RELEASED</span> <span class="o">=</span> <span class="n">df1</span><span class="p">.</span><span class="n">YEAR_RELEASED</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df1</span><span class="p">.</span><span class="nf">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">YEAR_RELEASED</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">year</span><span class="sh">"</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="p">.</span><span class="nf">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="sh">"</span><span class="s">year</span><span class="sh">"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="sh">"</span><span class="s">genre</span><span class="sh">"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="sh">"</span><span class="s">release_count</span><span class="sh">"</span><span class="p">)</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="p">.</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[(</span><span class="n">df1</span><span class="p">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df1</span><span class="p">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="mi">2020</span><span class="p">)]</span>
<span class="n">df1</span><span class="p">.</span><span class="nf">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">order_max</span> <span class="o">=</span> <span class="n">df1</span><span class="p">.</span><span class="nf">max</span><span class="p">().</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="n">index</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">order_max</span><span class="p">[:</span><span class="mi">10</span><span class="p">]]</span>
<span class="n">df1</span><span class="p">.</span><span class="nf">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>genre</th>
      <th>Electronic</th>
      <th>Rock</th>
      <th>Pop</th>
      <th>...</th>
      <th>Latin</th>
      <th>Reggae</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018</th>
      <td>156421</td>
      <td>124208</td>
      <td>41438</td>
      <td>...</td>
      <td>4106</td>
      <td>4321</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>152393</td>
      <td>118760</td>
      <td>39830</td>
      <td>...</td>
      <td>4039</td>
      <td>4189</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>162166</td>
      <td>115612</td>
      <td>37814</td>
      <td>...</td>
      <td>3280</td>
      <td>3813</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ax</span> <span class="o">=</span> <span class="n">df1</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="s">Number of annual releases by genre</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="sh">"</span><span class="s">Year</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="sh">"</span><span class="s">Number of releases</span><span class="sh">"</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<p align="center">
  <img width="800" src="/img/2022-07-06_01/output_64_0.png" alt="Number of annual releases by genre" />
</p>

<p>Kind of sad to see Jazz so low.</p>

<h3 id="close-the-duckdb-connection">Close the DuckDB connection</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">time</span>
<span class="n">conn</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 26.3 ms, sys: 4.55 ms, total: 30.8 ms
Wall time: 29.1 ms
</code></pre></div></div>

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://aetperf-github-io-1.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

